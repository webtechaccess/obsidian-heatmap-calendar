/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ee=Object.defineProperty;var Re=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var Oe=Object.prototype.hasOwnProperty;var _e=(x,t)=>{for(var e in t)ee(x,e,{get:t[e],enumerable:!0})},fe=(x,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of de(t))!Oe.call(x,o)&&o!==e&&ee(x,o,{get:()=>t[o],enumerable:!(n=Re(t,o))||n.enumerable});return x};var Te=x=>fe(ee({},"__esModule",{value:!0}),x);var he={};_e(he,{default:()=>Y});module.exports=Te(he);var J=require("obsidian");var j=require("obsidian");var ie={["Toggl API Auth"]:"Authenticate with Toggl by providing your API token to fetch time tracking data. Retrieve your token from Toggl Profile Settings. Leave blank to use fake data instead.",["Toggl Workspace ID"]:"Enter the Workspace ID associated with your Toggl account to fetch data for the correct workspace. Find it in your Toggl Workspace Settings.",["Toggl Project IDs"]:"Enter specific Toggl Project IDs (comma-separated) to filter data for selected projects. Leave blank to include all projects.",["Use Fake Data"]:"Enable this option to generate and use fake time tracking data instead of fetching data from Toggl. Useful for testing or demonstrations.",["Year"]:"Specify the year for which the heatmap calendar will be generated. Must be in YYYY format (e.g., 2023).",["Off Days"]:"Specify days you don\u2019t expect to log time (e.g., weekends). Use numbers: Sun = 0, Mon = 1, Tue = 2, Wed = 3, Thu = 4, Fri = 5, Sat = 6. Separate multiple days with commas (e.g., 0,6 for Sun and Sat). Off days do not affect streak lengths.",["Theme"]:"Select a theme to customize the heatmap calendar\u2019s appearance. Choosing a theme will automatically update related style configurations, such as colors and gradients, affecting how the heatmap is displayed.",["Font"]:"Choose the font style for the heatmap calendar. We recommend Iosevka (included in predefined themes) for its clean and modern design. This affects the text displayed in the calendar, such as dates and labels.",["Font Size"]:"Set the base font size for the heatmap calendar. Adjusting this value will proportionally scale other text elements, such as labels and annotations. Use a number (e.g., 24).",["Calendar Background"]:"Set the background of the heatmap calendar. Use named colors (e.g., white), hex codes (e.g., #fff2 for semi-transparency), or gradients. Gradients are prioritized in themes.",["Calendar Text Color"]:"Define the color for text elements, including day names, month names, and the year. Use named colors (e.g., black) or hex codes (e.g., #000000).",["Calendar Border Color"]:"Choose the color for the calendar\u2019s border. Use named colors (e.g., gray) or hex codes (e.g., #cccccc).",["Calendar Border Radius"]:"Adjust the corner radius for the calendar\u2019s border to control its roundedness. Use a number (e.g., 5).",["Calendar Padding"]:"Set the outer spacing around the entire calendar. Use a number (e.g., 10) to control the margin between the calendar and surrounding elements.",["Tooltip Background"]:"Set the background color for tooltips displayed when hovering over calendar cells. Use named colors (e.g., white), hex codes (e.g., #ffffff), or gradients.",["Tooltip Text Color"]:"Define the color of the text inside tooltips. Use named colors (e.g., black) or hex codes (e.g., #000000).",["Normal Day Background"]:"Set the background color for regular days. Use named colors (e.g., lightgray) or hex codes (e.g., #f0f0f0).",["Off Day Background"]:"Define the background color for off days (e.g., weekends or holidays). Use named colors (e.g., gray) or hex codes (e.g., #cccccc).",["Intensity Color"]:"Choose the color gradient used to represent activity intensity in the heatmap. Use named colors, hex codes, or gradients.",["Statistics Color"]:"Set the color for statistical elements (e.g., averages or totals) displayed in the calendar. Use named colors or hex codes.",["Billable Report Color"]:"Define the color for billable hours or reports in the heatmap. Use named colors or hex codes.",["Payed Hours"]:"Enter the total hours that have already been paid. This helps track remaining billable hours.",["Hourly Rate"]:"Set the hourly rate used for calculating billable amounts. Enter a numeric value (e.g., 50).",["Hourly Rate Currency"]:"Specify the currency for the hourly rate (e.g., USD, EUR). This ensures accurate billing calculations.",["Conversion Fee"]:"Enter any additional fee applied during currency conversion. Use a numeric value (e.g., 0.02 for 2%).",["Conversion Currency"]:"Set the target currency for conversion (e.g., USD to EUR). This is used for final billing calculations.",["Cell Size"]:"Set the size of each cell. Adjust this to control the overall dimensions of the calendar. Use a number around 10 (e.g., 7 to 15).",["Line Height"]:"Define the height of lines for statistics, billable reports, and other text blocks. Use a number (e.g., 20) for consistent spacing.",["Show Billable Information"]:"Enable this option to display billable information (e.g., payed, remains).",["Show General Statistics"]:"Enable this option to display general statistics (e.g., total hours, averages).",["Show Streaks Statistics"]:"Enable this option to display streak statistics (e.g., longest streak, current streak)."},re={"#ff0000":"Red","#00ff00":"Green","#0000ff":"Blue","#ffff00":"Yellow","#ff00ff":"Magenta","#00ffff":"Cyan","#ffffff":"White","#ff8800":"Orange","#ff0088":"Pink","#88ff00":"Lime","#00ff88":"Mint","#8800ff":"Purple","#0088ff":"Azure"},te=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var d={["Font"]:"Iosevka, Courier New, monospace",["Font Size"]:12,["Calendar Border Radius"]:10,["Calendar Padding"]:20,["Cell Size"]:10,["Line Height"]:16},ae={["Font"]:d["Font"],["Font Size"]:d["Font Size"],["Calendar Border Radius"]:d["Calendar Border Radius"],["Calendar Padding"]:d["Calendar Padding"],["Cell Size"]:d["Cell Size"],["Line Height"]:d["Line Height"],["Calendar Background"]:"linear-gradient(to bottom right, #111, #272727)",["Calendar Text Color"]:"#ddd",["Calendar Border Color"]:"#333",["Normal Day Background"]:"#444",["Off Day Background"]:"#2a2a2a",["Statistics Color"]:"white",["Billable Report Color"]:"white",["Tooltip Background"]:"white",["Tooltip Text Color"]:"black"},se={["Font"]:d["Font"],["Font Size"]:d["Font Size"],["Calendar Border Radius"]:d["Calendar Border Radius"],["Calendar Padding"]:d["Calendar Padding"],["Cell Size"]:d["Cell Size"],["Line Height"]:d["Line Height"],["Calendar Background"]:"linear-gradient(to bottom right, #eee, #f7f7f7)",["Calendar Text Color"]:"#333",["Calendar Border Color"]:"#ddd",["Normal Day Background"]:"#ccc",["Off Day Background"]:"#e4e4e4",["Statistics Color"]:"black",["Billable Report Color"]:"black",["Tooltip Background"]:"black",["Tooltip Text Color"]:"white"},le={["Font"]:d["Font"],["Font Size"]:d["Font Size"],["Calendar Border Radius"]:d["Calendar Border Radius"],["Calendar Padding"]:d["Calendar Padding"],["Cell Size"]:d["Cell Size"],["Line Height"]:d["Line Height"],["Calendar Background"]:"linear-gradient(to bottom right, #822, #228)",["Calendar Text Color"]:"#ccc",["Calendar Border Color"]:"#888",["Normal Day Background"]:"#fff4",["Off Day Background"]:"#faa2",["Statistics Color"]:"#ddf",["Billable Report Color"]:"#ff0",["Tooltip Background"]:"#228c",["Tooltip Text Color"]:"white"},ce={["Font"]:d["Font"],["Font Size"]:0,["Calendar Border Radius"]:0,["Calendar Padding"]:0,["Cell Size"]:6,["Line Height"]:0,["Calendar Background"]:"",["Calendar Text Color"]:"",["Calendar Border Color"]:"",["Normal Day Background"]:"#8886",["Off Day Background"]:"#8883",["Statistics Color"]:"",["Billable Report Color"]:"",["Tooltip Background"]:"",["Tooltip Text Color"]:""};var f=class{static fixLength(t,e){return t.padEnd(e," ")}static computeFont(t,e){return e/12*t["Font Size"]+"px "+t["Font"]}static isNumber(t){return typeof t!="string"||t.trim()===""?!1:!isNaN(parseFloat(t))}static convertToHourMin(t){if(isNaN(t))return"0:00";let e=Math.floor(t),n=Math.round((t-e)*60);return`${e}:${n.toString().padStart(2,"0")}`}static generateHex(t){let e="0123456789abcdef",n="";for(let o=0;o<t;o++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}static getDayOfWeek(t){return new Date(t).getDay()}static getColor(t,e,n){let c=Math.floor(e/n*180+75),a=t["Intensity Color"],R=L=>{let I=parseInt(L.slice(1,3),16),p=parseInt(L.slice(3,5),16),s=parseInt(L.slice(5,7),16);return{r:I,g:p,b:s}};return((L,I)=>{let{r:p,g:s,b:l}=R(L),O=I/255;return`rgb(${Math.floor(p*O)}, ${Math.floor(s*O)}, ${Math.floor(l*O)})`})(a,c)}static getStreaks(t,e){let n=Object.keys(e).map(a=>new Date(a));n.sort((a,R)=>a.getTime()-R.getTime());let o=[],c=1;for(let a=1;a<n.length;a++){let R=t["Off Days"].includes(n[a-1].getDay());(n[a].getTime()-n[a-1].getTime())/(1e3*60*60*24)===1||R?c++:(o.push(c),c=1)}return o.push(c),o}static computeStreakStats(t,e){let n=this.getStreaks(t,e),o=n.length,c=n.reduce((R,A)=>R+A,0)/o,a=Math.max(...n);return{streakCount:o,averageStreak:c,longestStreak:a}}};var M=class{static setError(t){M.error=t}static clearError(){M.error=void 0}static render(t,e,n){let o=Object.values(n).map(r=>r.totalDuration),c=Math.min(...o),a=Math.max(...o),R=0;for(let r in n)R+=n[r].totalDuration;let A=o.reduce((r,E)=>r+E,0)/365,L=o.reduce((r,E)=>r+Math.pow(E-A,2),0)/365,I=Math.sqrt(L),p=f.computeStreakStats(e,n);t.querySelectorAll("canvas").forEach(r=>r.remove());let l=document.createElement("canvas");l.addClass("clhc-canvas");let O=document.createElement("canvas");O.addClass("clhc-tooltip-canvas");let T=e["Cell Size"],_=T/5,h=e["Calendar Padding"]+e["Line Height"],G=e["Calendar Padding"]+30,H=0;e["Show Billable Information"]&&H++,e["Show Streaks Statistics"]&&H++,e["Show General Statistics"]&&H++,H>0&&H++,e["Font Size"]===0&&(H=0,h=e["Calendar Padding"],G=e["Calendar Padding"]);let $=H*e["Line Height"],u=[31,28,31,30,31,30,31,31,30,31,30,31];e["Year"]%4===0&&(u[1]=29);let D=0,v=0,F=0;for(let r=0;r<12;r++)for(let E=1;E<=u[r];E++)F=v*(T+_)+r*(T+_+T)+G,D++,D===7&&(v++,D=0);l.width=F+T+e["Calendar Padding"],l.height=7*(T+_)+h+$+e["Calendar Padding"],O.width=l.width,O.height=l.height,e["Calendar Border Color"]&&l.style.setProperty("--clhc-calendar-border-color",e["Calendar Border Color"]),l.style.setProperty("--clhc-calendar-border-radius",e["Calendar Border Radius"]+"px"),l.style.setProperty("--clhc-calendar-background",e["Calendar Background"]);let i=l.getContext("2d");if(!i)return;function C(r,E,S){let g="opacity(0.75)";i.filter=g,r.split(/(<|>)/).forEach(P=>{P==="<"?i.filter="none":P===">"?i.filter=g:(i.fillText(P,E,S),E+=i.measureText(P).width)}),i.filter="none"}if(i.imageSmoothingEnabled=!0,M.error){let r=M.error.split(`
`),E=r[0],S=r.slice(1),g=30;i.fillStyle="#212",i.fillRect(0,0,l.width,l.height),i.textAlign="center",i.textBaseline="middle",i.fillStyle="#f44",i.font=f.computeFont(e,20),i.fillText(E,l.width/2,g),S&&(i.font=f.computeFont(e,16),i.textAlign="left",i.fillStyle="#aaa",S.forEach(N=>{g+=20,i.fillText(N,20,g)})),t.setText(""),t.appendChild(l);return}let b=O.getContext("2d"),U=[...Array(12)].map((r,E)=>new Date(0,E).toLocaleString("default",{month:"short"}));i.textAlign="left",i.textBaseline="top",i.font=f.computeFont(e,14),i.fillStyle=e["Calendar Text Color"],i.fillText(""+e["Year"],e["Calendar Padding"],e["Calendar Padding"]);for(let r=0;r<te.length;r++){let E=e["Calendar Padding"],S=r*(T+_)+h+T/2;i.textAlign="left",i.textBaseline="middle",i.font=f.computeFont(e,11),i.fillStyle=e["Calendar Text Color"],i.fillText(te[r],E,S)}D=0,v=0;let X=[];F=0;let q=0;D=f.getDayOfWeek(e["Year"]+"-01-01");for(let r=0;r<12;r++){for(let E=1;E<=u[r];E++){let S=`${e["Year"]}-${String(r+1).padStart(2,"0")}-${String(E).padStart(2,"0")}`,g=n[S],N=g?g.totalDuration:0,P=g?g.humanize:"0:00",Ee=v*(T+_),Ae=D*(T+_),Q=Ee+r*(T+_+T)+G,Z=Ae+h;F=Q,Z>q&&(q=Z),i.fillStyle="transparent",g?i.fillStyle=f.getColor(e,N,a):e["Off Days"].includes(D)?i.fillStyle=e["Off Day Background"]:i.fillStyle=e["Normal Day Background"],i.fillRect(Q,Z,T,T),X.push({date:S,x:Q,y:Z,width:T,height:T,value:P!=null?P:0}),D++,D===7&&(v++,D=0)}i.font=f.computeFont(e,12),i.fillStyle=e["Calendar Text Color"],i.textAlign="right",i.textBaseline="top",i.fillText(U[r],F-T,e["Calendar Padding"])}i.textBaseline="top";let w=q+e["Line Height"];function y(r,E){return f.fixLength(r+": <"+E,25)+">"}if(e["Show Billable Information"]){w+=e["Line Height"];let r=Math.round(R*e["Hourly Rate"]),E=e["Payed Hours"]*e["Hourly Rate"],S=r-E,g=S*e["Conversion Fee"],N=y("Payed",new Intl.NumberFormat().format(E)+" "+e["Hourly Rate Currency"]);N+=y("Payable",new Intl.NumberFormat().format(r)+" "+e["Hourly Rate Currency"]),N+=y("Remains",new Intl.NumberFormat().format(S)+" "+e["Hourly Rate Currency"]),N+=y("Billable",new Intl.NumberFormat().format(g)+" "+e["Conversion Currency"]),i.textAlign="left",i.font=f.computeFont(e,14),i.fillStyle=e["Billable Report Color"],C(N,e["Calendar Padding"],w)}if(e["Show General Statistics"]){w+=e["Line Height"];let r=y("Average",f.convertToHourMin(A));r+=y("Deviation",f.convertToHourMin(I)),r+=y("Minimum",f.convertToHourMin(c)),r+=y("Maximum",f.convertToHourMin(a)),r+=y("Summary",f.convertToHourMin(R)),i.textAlign="left",i.font=f.computeFont(e,14),i.fillStyle=e["Statistics Color"],C(r,e["Calendar Padding"],w)}if(e["Show Streaks Statistics"]){w+=e["Line Height"];let r=y("Streaks",p.streakCount);r+=y("Average",Math.round(p.averageStreak)),r+=y("Longest",p.longestStreak),i.textAlign="left",i.font=f.computeFont(e,14),i.fillStyle=e["Statistics Color"],C(r,e["Calendar Padding"],w)}t.setText(""),t.appendChild(l),t.appendChild(O),b&&(l.addEventListener("mousemove",r=>{let E=r.offsetX,S=r.offsetY,g=!1;if(b.clearRect(0,0,O.width,O.height),e["Tooltip Background"]){for(let N of X)if(E>=N.x&&E<=N.x+N.width&&S>=N.y&&S<=N.y+N.height){b.fillStyle=e["Tooltip Background"],b.fillRect(E-150/2,S+5,150,30),b.textAlign="center",b.font=f.computeFont(e,12),b.fillStyle=e["Tooltip Text Color"],b.fillText(`${N.date} | ${N.value} Hours`,E,S+25),g=!0;break}}g||b.clearRect(0,0,O.width,O.height)}),l.addEventListener("mouseout",r=>{b.clearRect(0,0,O.width,O.height)}))}},m=M;m.error=void 0;var W=class extends j.Modal{constructor(e,n,o){super(e);this.tabsContent=[];this.tabsNames=["Query","Style","Billable","Stats","Donate"];this.config=n,this.onSubmit=o}onOpen(){let e=this,{containerEl:n,contentEl:o}=this;n.addClass("clhc");let c=this.titleEl;this.setTitle("Settings");let a={};Object.entries(this.config).forEach(([_,h])=>{a[_]=h}),this.tabContainer=o.createDiv({cls:"tabs"}),this.tabContentContainer=o.createDiv({cls:"tab-content"});for(let _=0;_<this.tabsNames.length;_++){let h=this.tabContainer.createEl("button",{text:this.tabsNames[_]});h.onclick=()=>this.showTab(_);let G=this.tabContentContainer.createDiv();G.addClass("clhc-tab-content"),this.tabsContent.push(G)}let R=this.tabsContent[0],A=this.tabsContent[1],L=this.tabsContent[2],I=this.tabsContent[3],p=this.tabsContent[4];function s(_,h,G,H=null,$=null){var i;let u=G,D=new j.Setting(_).setDesc((i=ie[u])!=null?i:""),v=C=>{var b;W.componentMap[u]=C,h.includes("select")&&C.addOptions(H),h==="number"?C.setValue(""+a[u]):h.includes("array")?C.setValue(JSON.parse((b=a[u])!=null?b:"[]").join(", ")):C.setValue(a[u]),C.updateValue=U=>{C.setValue(U),C.updateValueCore(U)},C.updateValueCore=U=>{m.clearError(),(u==="Toggl API Auth"||u==="Toggl Workspace ID"||u==="Use Fake Data"||u==="Year"||u==="Toggl Project IDs"||u==="Off Days")&&Y.clearCache(),h==="number"?a[u]=parseInt(U):h.includes("array")?a[u]=`[${U.split(",").map(X=>X.trim()).join(",")}]`:a[u]=U,Y.validate(a),$&&$(U),e.onSubmit(a)},C.onChange(U=>{C.updateValueCore(U)}),C.inputEl&&(h.includes("long")?C.inputEl.addClass("long"):C.inputEl.removeClass("long"))};h==="check"?D.addToggle(v):h.includes("select")?D.addDropdown(v):D.addText(v);let F=document.createElement("div");return F.textContent=G,D.controlEl.insertBefore(F,D.controlEl.firstChild),W.settingsMap[u]=D,D}s(R,"long-text","Toggl API Auth"),s(R,"number","Toggl Workspace ID"),s(R,"check","Use Fake Data"),s(R,"number","Year"),s(R,"long-array","Toggl Project IDs"),s(R,"array","Off Days"),s(R,"select","Intensity Color",re);function l(_){Object.entries(_).forEach(([h,G])=>{W.componentMap[h].updateValue(G)})}s(A,"select","Theme",{dark:"Dark",light:"Light",vivid:"Vivid",minimal:"Minimal"},_=>{_==="dark"&&l(ae),_==="light"&&l(se),_==="vivid"&&l(le),_==="minimal"&&l(ce)}),s(A,"long-text","Font"),s(A,"number","Font Size"),s(A,"long-text","Calendar Background"),s(A,"color","Calendar Text Color"),s(A,"color","Calendar Border Color"),s(A,"number","Calendar Border Radius"),s(A,"number","Calendar Padding"),s(A,"color","Normal Day Background"),s(A,"color","Off Day Background"),s(A,"color","Tooltip Background"),s(A,"color","Tooltip Text Color"),s(A,"color","Statistics Color"),s(A,"color","Billable Report Color"),s(A,"number","Cell Size"),s(A,"number","Line Height"),s(L,"number","Payed Hours"),s(L,"number","Hourly Rate"),s(L,"text","Hourly Rate Currency"),s(L,"number","Conversion Fee"),s(L,"text","Conversion Currency"),s(I,"check","Show Billable Information"),s(I,"check","Show General Statistics"),s(I,"check","Show Streaks Statistics");let O=p.createEl("div");O.createEl("span",{attr:{class:"clhc-donation-emoji"},text:"\u{1F496}"}),O.createEl("h3",{text:"Every contribution, is greatly appreciated!"}),O.createEl("p",{text:"If you\u2019ve enjoyed using this heatmap calendar or found it helpful, consider contributing to its development."}),O.createEl("p",{text:"Your gift will help me improve features, fix bugs, and keep this project alive for the community."});let T=O.createEl("ul");T.createEl("li",{text:"One-Time Donation: "}).createEl("a",{href:"https://buy.stripe.com/00gaEM1lA7yF664fYY",text:"Donate via Stripe"}),T.createEl("li",{text:"Monthly Subscription: "}).createEl("a",{href:"https://buy.stripe.com/14kbIQc0ebOVgKI9AB",text:"Subscribe via Stripe"}),this.showTab(0),this.makeMovable(this.modalEl,c)}makeMovable(e,n){let o=!1,c=0,a=0,R=0,A=0,L=(window.innerWidth-e.offsetWidth)/2,I=(window.innerHeight-e.offsetHeight)/2;e.style.setProperty("--clhc-modal-position-left",`${L}px`),e.style.setProperty("--clhc-modal-position-top",`${I}px`),n.addEventListener("mousedown",l=>{o=!0,R=e.offsetLeft,A=e.offsetTop,c=l.clientX,a=l.clientY,document.addEventListener("mousemove",p),document.addEventListener("mouseup",s)});let p=l=>{if(!o)return;let O=R+(l.clientX-c),T=A+(l.clientY-a),_=window.innerWidth-e.offsetWidth,h=window.innerHeight-e.offsetHeight;e.style.setProperty("--clhc-modal-position-left",`${Math.min(Math.max(O,0),_)}px`),e.style.setProperty("--clhc-modal-position-top",`${Math.min(Math.max(T,0),h)}px`)},s=()=>{o=!1,document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",s)}}showTab(e){var o,c;this.tabsContent.forEach(a=>{a.classList.remove("active")});for(let a=0;a<this.tabsNames.length;a++)(o=this.tabContainer.querySelector(`button:nth-child(${a+1})`))==null||o.classList.remove("active");(c=this.tabContainer.querySelector(`button:nth-child(${e+1})`))==null||c.classList.add("active"),this.tabsContent[e].classList.add("active")}onClose(){let{contentEl:e}=this;e.empty()}},K=W;K.settingsMap={},K.componentMap={};var oe=class{static randomDuration(){return parseFloat((Math.random()*2).toFixed(10))}static humanizeDuration(t){let e=Math.floor(t),n=Math.round((t-e)*60);return`${e}:${n.toString().padStart(2,"0")}`}static randomDate(t){let e=new Date(t,0,1),n=new Date(t,11,31),o=e.getTime()+Math.random()*(n.getTime()-e.getTime());return new Date(o).toISOString().split("T")[0]}static fetch(t,e){let n={};for(;Object.keys(n).length<oe.RECORDS_COUNT;){let o=this.randomDate(t["Year"]);if(!n[o]){let c=this.randomDuration();n[o]={totalDuration:c,entries:[],humanize:this.humanizeDuration(c)}}}e(n)}},V=oe;V.RECORDS_COUNT=50;var z=class{static async fetch(t,e){var L;let n=t["Toggl API Auth"];if(!n||n.length!==32){m.setError(`Invalid or Missing Toggl API Token

The provided Toggl API token is either missing or invalid.
Please ensure the following:
  1. Enter a valid API token from your Toggl account.
  2. Verify the token length and ensure it matches the required format.

You can retrieve your API token from your Toggl Profile Settings.
For further assistance, refer to the Toggl API documentation.`),e({});return}let o=t["Toggl Workspace ID"];if(!o){m.setError(`Invalid Workspace ID

The provided Toggl Workspace ID is invalid. Please ensure the following:
  1. Enter the correct Workspace ID associated with your Toggl account.
  2. Verify the ID matches the format expected by the Toggl API.

You can find your Workspace ID in your Toggl Workspace Settings.
For further details, consult the Toggl API documentation.`),e({});return}let c=JSON.parse((L=t["Toggl Project IDs"])!=null?L:"[]"),a={},R="";c.length>0&&(R="&project_ids="+c.join(","));let A=`https://api.track.toggl.com/reports/api/v2/details?workspace_id=${o}&user_agent=heatmap&since=${t["Year"]}-01-01&until=${t["Year"]}-12-31&per_page=1000000${R}`;try{let I={Authorization:"Basic "+btoa(n+":api_token")};(await this.fetchAllTimeEntries(A,I)).forEach(s=>{let l=s.start.split("T")[0],O=s.dur/1e3/60/60;a[l]||(a[l]={totalDuration:0,entries:[]}),a[l].totalDuration+=O,a[l].humanize=f.convertToHourMin(a[l].totalDuration)})}catch(I){}e(a)}static async fetchAllTimeEntries(t,e){let n=[],c=await(await fetch(`${t}`,{method:"GET",headers:e})).json();return n=n.concat(c.data),n}};var B=class extends J.Plugin{static clearCache(){B.cache={}}async onload(){this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{B.clearCache()})),window.ba_heatmap_renderer=(t,e)=>(e.id=t,this.render(e)),this.addCommand({id:"insert",name:"Insert",callback:()=>{let t={["Toggl API Auth"]:"",["Toggl Workspace ID"]:"",["Toggl Project IDs"]:"[]",["Use Fake Data"]:!0,["Year"]:new Date().getFullYear(),["Off Days"]:"[]",["Theme"]:"Dark",["Calendar Border Color"]:"",["Intensity Color"]:"#00ff88",["Payed Hours"]:0,["Hourly Rate"]:0,["Hourly Rate Currency"]:"USD",["Conversion Fee"]:0,["Conversion Currency"]:"USD",["Show General Statistics"]:!0,["Show Streaks Statistics"]:!0,["Show Billable Information"]:!0,["Font"]:d["Font"],["Font Size"]:d["Font Size"],["Calendar Border Radius"]:d["Calendar Border Radius"],["Calendar Padding"]:d["Calendar Padding"],["Cell Size"]:d["Cell Size"],["Line Height"]:d["Line Height"],["Calendar Background"]:"linear-gradient(to bottom right, #111, #272727)",["Calendar Text Color"]:"#ddd",["Calendar Border Color"]:"#333",["Normal Day Background"]:"#444",["Off Day Background"]:"#2a2a2a",["Statistics Color"]:"white",["Billable Report Color"]:"white",["Tooltip Background"]:"white",["Tooltip Text Color"]:"black"};t.id=f.generateHex(32);let e=B.generateScript(t),n=this.getActiveEditor();n.replaceRange(e,n.getCursor()),this.openSettings(t)}})}getActiveEditor(){let t=this.app.workspace.activeLeaf;return(t==null?void 0:t.view)instanceof J.MarkdownView?t.view.editor:null}static generateScript(t){let e="\n\n```dataviewjs\n";return e+=`dv.paragraph("").appendChild(ba_heatmap_renderer("${t.id}", {
`,Object.entries(t).forEach(([n,o])=>{if(n!=="id")if(typeof o=="number")e+=`  '${n}': ${o},
`;else if(typeof o=="boolean")e+=`  '${n}': ${o},
`;else if(Array.isArray(o)){let c=JSON.stringify(o);e+=`  '${n}': "${c}",
`}else typeof o=="string"&&(e+=`  '${n}': "${o}",
`)}),e+=`}))
`,e+="```\n\n",e}openSettings(t){new K(this.app,t,async e=>{let n=B.generateScript(e),o=this.app.workspace.getActiveFile(),c=await this.app.vault.read(o),a=new RegExp('\\s*```[^`]*"'+t.id+'"[^`]*```\\s*',"gs"),R=c.replace(a,n);await this.app.vault.modify(o,R)}).open()}render(t){let e=createEl("div",{text:"Loading...",attr:{class:"clhc-container-div"}});B.validate(t);let n=t.id+"-"+(t["Use Fake Data"]?"fake":"toggl");return B.cache[n]?m.render(e,t,B.cache[n]):t["Use Fake Data"]?V.fetch(t,o=>{B.cache[n]=o,m.render(e,t,o)}):z.fetch(t,o=>{B.cache[n]=o,m.render(e,t,o)}),e.addEventListener("click",()=>{this.openSettings(t)}),e}static validate(t){if(!t["Year"]||t["Year"]<2e3||t["Year"]>2100){m.setError(`Invalid Year

The provided year is invalid. Please ensure the following:
  1. Enter a valid year in the correct format (e.g., 2023).
  2. Ensure the year is within a reasonable range (e.g., 2000-2100).

This field is required to generate the heatmap calendar.`);return}m.clearError()}},Y=B;Y.cache={};
